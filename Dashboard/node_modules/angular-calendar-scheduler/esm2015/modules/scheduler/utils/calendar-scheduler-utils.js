// WORKAROUND: https://github.com/dherges/ng-packagr/issues/217#issuecomment-339460255
import * as momentImported from 'moment';
const moment = momentImported;
export var DAYS_OF_WEEK;
(function (DAYS_OF_WEEK) {
    DAYS_OF_WEEK[DAYS_OF_WEEK["SUNDAY"] = 0] = "SUNDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["MONDAY"] = 1] = "MONDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["TUESDAY"] = 2] = "TUESDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["WEDNESDAY"] = 3] = "WEDNESDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["THURSDAY"] = 4] = "THURSDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["FRIDAY"] = 5] = "FRIDAY";
    DAYS_OF_WEEK[DAYS_OF_WEEK["SATURDAY"] = 6] = "SATURDAY";
})(DAYS_OF_WEEK || (DAYS_OF_WEEK = {}));
const DEFAULT_WEEKEND_DAYS = [
    DAYS_OF_WEEK.SUNDAY,
    DAYS_OF_WEEK.SATURDAY
];
export const DAYS_IN_WEEK = 7;
export const HOURS_IN_DAY = 24;
export const MINUTES_IN_HOUR = 60;
export const SECONDS_IN_DAY = 60 * 60 * 24;
export const DEFAULT_HOUR_SEGMENT_HEIGHT_PX = 40;
export const DEFAULT_EVENT_WIDTH = 1;
export const DEFAULT_HOUR_SEGMENTS = 2;
export function getSchedulerViewHourGrid(dateAdapter, { viewDate, hourSegments, dayStart, dayEnd }) {
    const { setMinutes, setHours, startOfDay, startOfMinute, endOfDay, addMinutes, addHours, addDays } = dateAdapter;
    const hours = [];
    let startOfView = setMinutes(setHours(startOfDay(viewDate), sanitiseHours(dayStart.hour)), sanitiseMinutes(dayStart.minute));
    let endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), sanitiseHours(dayEnd.hour)), sanitiseMinutes(dayEnd.minute));
    const segmentDuration = MINUTES_IN_HOUR / hourSegments;
    let startOfViewDay = startOfDay(viewDate);
    const endOfViewDay = endOfDay(viewDate);
    let dateAdjustment = (d) => d;
    // this means that we change from or to DST on this day and that's going to cause problems so we bump the date
    if (startOfViewDay.getTimezoneOffset() !== endOfViewDay.getTimezoneOffset()) {
        startOfViewDay = addDays(startOfViewDay, 1);
        startOfView = addDays(startOfView, 1);
        endOfView = addDays(endOfView, 1);
        dateAdjustment = (d) => addDays(d, -1);
    }
    for (let i = 0; i < HOURS_IN_DAY; i++) {
    }
    for (let i = 0; i < HOURS_IN_DAY; i++) {
        const segments = [];
        for (let j = 0; j < hourSegments; j++) {
            const date = addMinutes(addHours(startOfViewDay, i), j * segmentDuration);
            if (date >= startOfView && date < endOfView) {
                segments.push({
                    date: dateAdjustment(date),
                    displayDate: date,
                    isStart: j === 0
                });
            }
        }
        if (segments.length > 0) {
            hours.push({ segments });
        }
    }
    return hours;
}
export function getSchedulerView(dateAdapter, { events = [], viewDate, viewDays, weekStartsOn, startsWithToday, excluded = [], hourSegments = DEFAULT_HOUR_SEGMENTS, dayStart, dayEnd, weekendDays = DEFAULT_WEEKEND_DAYS, hourSegmentHeight = DEFAULT_HOUR_SEGMENT_HEIGHT_PX, eventWidth = DEFAULT_EVENT_WIDTH, logEnabled, }) {
    if (!events) {
        events = [];
    }
    const { addDays, startOfDay, endOfDay, startOfWeek, endOfWeek } = dateAdapter;
    const startOfViewWeek = startsWithToday || viewDays < DAYS_IN_WEEK ? startOfDay(viewDate) : startOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    const endOfViewWeek = startsWithToday || viewDays < DAYS_IN_WEEK ? addDays(endOfDay(viewDate), viewDays - 1) : endOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    const eventsInWeek = getEventsInPeriod(dateAdapter, {
        events: events,
        periodStart: startOfViewWeek,
        periodEnd: endOfViewWeek
    });
    const days = getSchedulerViewDays(dateAdapter, {
        viewDate: viewDate,
        viewDays: viewDays,
        weekStartsOn: weekStartsOn,
        startsWithToday: startsWithToday,
        excluded: excluded,
        weekendDays: weekendDays
    });
    days.forEach((day) => {
        const startOfView = dateAdapter.setMinutes(dateAdapter.setHours(dateAdapter.startOfDay(day.date), dayStart.hour), dayStart.minute);
        const endOfView = dateAdapter.setMinutes(dateAdapter.setHours(dateAdapter.startOfMinute(dateAdapter.endOfDay(day.date)), dayEnd.hour), dayEnd.minute);
        const previousDayEvents = [];
        const eventsInDay = getEventsInPeriod(dateAdapter, {
            events: eventsInWeek,
            periodStart: startOfView,
            periodEnd: endOfView
        });
        const dayEvents = eventsInDay
            .sort((eventA, eventB) => eventA.start.valueOf() - eventB.start.valueOf())
            .map((ev) => {
            const eventStart = ev.start;
            const eventEnd = ev.end || eventStart;
            const startsBeforeDay = eventStart < startOfView;
            const endsAfterDay = dateAdapter.addMinutes(eventEnd, -1) > endOfView;
            const hourHeightModifier = ((hourSegments * hourSegmentHeight) + 1) / MINUTES_IN_HOUR; // +1 for the 1px segment bottom border
            let top = 0;
            if (eventStart > startOfView) {
                top += dateAdapter.differenceInMinutes(eventStart, startOfView);
            }
            top *= hourHeightModifier;
            const startDate = startsBeforeDay ? startOfView : eventStart;
            const endDate = endsAfterDay ? endOfView : eventEnd;
            let height = dateAdapter.differenceInMinutes(endDate, startDate);
            if (!ev.end) {
                height = hourSegmentHeight;
            }
            else {
                height *= hourHeightModifier;
            }
            const bottom = top + height;
            const overlappingPreviousEvents = getOverLappingEvents(ev, previousDayEvents, top, bottom, logEnabled);
            let left = 0;
            while (overlappingPreviousEvents.some(previousEvent => previousEvent.left === left)) {
                left += eventWidth;
            }
            const event = {
                event: ev,
                top: top,
                height: height,
                width: eventWidth,
                left: left,
                startsBeforeDay: startsBeforeDay,
                endsAfterDay: endsAfterDay
            };
            previousDayEvents.push(event);
            return event;
        });
        function getColumnCount(allEvents, prevOverlappingEvents) {
            const columnCount = Math.max(...prevOverlappingEvents.map((ev) => ev.left + 1));
            const nextOverlappingEvents = allEvents
                .filter((ev) => ev.left >= columnCount)
                .filter((ev) => {
                return (getOverLappingEvents(ev, prevOverlappingEvents, ev.top, ev.top + ev.height, logEnabled).length > 0);
            });
            if (nextOverlappingEvents.length > 0) {
                return getColumnCount(allEvents, nextOverlappingEvents);
            }
            else {
                return columnCount;
            }
        }
        const mappedEvents = dayEvents.map(event => {
            const columnCount = getColumnCount(dayEvents, getOverLappingEvents(event, dayEvents, event.top, event.top + event.height, logEnabled));
            const width = 100 / columnCount;
            return Object.assign(Object.assign({}, event), { left: event.left * width, width });
        });
        day.events = mappedEvents.map(event => {
            const overLappingEvents = getOverLappingEvents(event, mappedEvents.filter(otherEvent => otherEvent.left > event.left), event.top, event.top + event.height, logEnabled);
            if (logEnabled) {
                console.log(`DAY [${moment(day.date).format('dddd L')}] ` +
                    `- EVENT ${event.event.id} [${moment(event.event.start).format('dddd L, LTS')} ` +
                    `- ${moment(event.event.end).format('dddd L, LTS')}] overLappingEvents -> `, overLappingEvents);
            }
            if (overLappingEvents.length > 0) {
                return Object.assign(Object.assign({}, event), { width: Math.min(...overLappingEvents.map(otherEvent => otherEvent.left)) - event.left });
            }
            return event;
        });
        day.hours = getSchedulerViewHourGrid(dateAdapter, {
            viewDate: viewDate,
            hourSegments: hourSegments,
            dayStart: {
                hour: dayStart.hour,
                minute: dayStart.minute
            },
            dayEnd: {
                hour: dayEnd.hour,
                minute: dayEnd.minute
            }
        }).map((hour) => {
            const date = new Date(day.date.getFullYear(), day.date.getMonth(), day.date.getDate(), hour.segments[0].date.getHours());
            const startOfHour = new Date(day.date.getFullYear(), day.date.getMonth(), day.date.getDate(), hour.segments[0].date.getHours());
            const endOfHour = dateAdapter.addSeconds(dateAdapter.addHours(startOfHour, 1), -1);
            const eventsInHour = getSchedulerEventsInPeriod(dateAdapter, {
                events: day.events,
                periodStart: startOfHour,
                periodEnd: endOfHour
            });
            const segments = hour.segments.map((segment) => {
                segment.date = dateAdapter.setDate(dateAdapter.setMonth(dateAdapter.setYear(segment.date, day.date.getFullYear()), day.date.getMonth()), day.date.getDate());
                const startOfSegment = segment.date;
                const endOfSegment = dateAdapter.addSeconds(dateAdapter.addMinutes(startOfSegment, MINUTES_IN_HOUR / hourSegments), -1);
                const eventsInSegment = getSchedulerEventsInPeriod(dateAdapter, {
                    events: eventsInHour,
                    periodStart: startOfSegment,
                    periodEnd: endOfSegment
                });
                if (logEnabled) {
                    console.log(`SEGMENT [${moment(startOfSegment).format('dddd L, LTS')} - ${moment(endOfSegment).format('dddd L, LTS')}] EVENTS -> `, eventsInSegment);
                }
                return {
                    segment: segment,
                    date: new Date(segment.date),
                    events: eventsInSegment
                };
            });
            return {
                hour: hour,
                date: date,
                events: eventsInHour,
                segments: segments
            };
        });
    });
    return {
        days: days,
        period: {
            events: eventsInWeek,
            start: startOfViewWeek,
            end: endOfViewWeek
        }
    };
}
export function getSchedulerViewDays(dateAdapter, { viewDate, viewDays, weekStartsOn, startsWithToday, excluded = [], weekendDays = DEFAULT_WEEKEND_DAYS }) {
    const start = startsWithToday || viewDays < DAYS_IN_WEEK
        ? new Date(viewDate)
        : dateAdapter.startOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    const days = [];
    const loop = (i) => {
        const date = dateAdapter.addDays(start, i);
        if (!excluded.some((e) => date.getDay() === e)) {
            days.push(getSchedulerDay(dateAdapter, { date, weekendDays }));
        }
    };
    for (let i = 0; i < viewDays; i++) {
        loop(i);
    }
    return days;
}
function getSchedulerDay(dateAdapter, args) {
    const date = args.date;
    const today = dateAdapter.startOfDay(new Date());
    return {
        date: date,
        isPast: date < today,
        isToday: dateAdapter.isSameDay(date, today),
        isFuture: date >= dateAdapter.addDays(today, 1),
        isWeekend: args.weekendDays.indexOf(dateAdapter.getDay(date)) > -1,
        inMonth: dateAdapter.isSameMonth(date, today),
        hours: []
    };
}
function getEventsInPeriod(dateAdapter, { events, periodStart, periodEnd }) {
    return events.filter((event) => isEventInPeriod(dateAdapter, { event: event, periodStart: periodStart, periodEnd: periodEnd }));
}
function getSchedulerEventsInPeriod(dateAdapter, { events, periodStart, periodEnd }) {
    return events.filter((event) => isEventInPeriod(dateAdapter, { event: event.event, periodStart: periodStart, periodEnd: periodEnd }));
}
function isEventInPeriod(dateAdapter, { event, periodStart, periodEnd }) {
    const { isSameSecond, addSeconds } = dateAdapter;
    const eventStart = event.start;
    const eventEnd = event.end || event.start;
    if (eventStart > periodStart && eventStart < periodEnd) {
        return true;
    }
    if (eventEnd > periodStart && eventEnd < periodEnd) {
        return true;
    }
    if (eventStart < periodStart && eventEnd > periodEnd) {
        return true;
    }
    if (isSameSecond(eventStart, periodStart) || isSameSecond(eventStart, periodEnd)) {
        return true;
    }
    if (isSameSecond(addSeconds(eventEnd, -1), periodStart) || isSameSecond(addSeconds(eventEnd, -1), periodEnd)) {
        return true;
    }
    return false;
}
function getOverLappingEvents(event /*SchedulerViewEvent | CalendarSchedulerEvent*/, events, top, bottom, logEnabled = false) {
    return events.filter((previousEvent) => {
        var _a, _b, _c;
        top = Math.round(top);
        bottom = Math.round(bottom);
        const previousEventTop = Math.floor(previousEvent.top);
        const previousEventBottom = Math.floor(previousEvent.top + previousEvent.height);
        if (top < previousEventBottom && previousEventBottom < bottom) {
            if (logEnabled) {
                console.log('[getOverLappingEvents] - EVENT ' + (((_a = event.event) === null || _a === void 0 ? void 0 : _a.id) || event.id) + ' -> top: ' + top + ' - bottom: ' + bottom + ' | PREVIOUS EVENT ' + previousEvent.event.id
                    + ' -> previousEventTop: ' + previousEventTop + ' - previousEventBottom: ' + previousEventBottom + ' -> top < previousEventBottom && previousEventBottom < bottom');
            }
            return true;
        }
        else if (top < previousEventTop && previousEventTop < bottom) {
            if (logEnabled) {
                console.log('[getOverLappingEvents] - EVENT ' + (((_b = event.event) === null || _b === void 0 ? void 0 : _b.id) || event.id) + ' -> top: ' + top + ' - bottom: ' + bottom + ' | PREVIOUS EVENT ' + previousEvent.event.id
                    + ' -> previousEventTop: ' + previousEventTop + ' - previousEventBottom: ' + previousEventBottom + ' -> top < previousEventTop && previousEventTop < bottom');
            }
            return true;
        }
        else if (previousEventTop <= top && bottom <= previousEventBottom) {
            if (logEnabled) {
                console.log('[getOverLappingEvents] - EVENT ' + (((_c = event.event) === null || _c === void 0 ? void 0 : _c.id) || event.id) + ' -> top: ' + top + ' - bottom: ' + bottom + ' | PREVIOUS EVENT ' + previousEvent.event.id
                    + ' -> previousEventTop: ' + previousEventTop + ' - previousEventBottom: ' + previousEventBottom + ' -> previousEventTop <= top && bottom <= previousEventBottom');
            }
            return true;
        }
        return false;
    });
}
function sanitiseHours(hours) {
    return Math.max(Math.min(23, hours), 0);
}
function sanitiseMinutes(minutes) {
    return Math.max(Math.min(59, minutes), 0);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItc2NoZWR1bGVyLXV0aWxzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1jYWxlbmRhci1zY2hlZHVsZXIvIiwic291cmNlcyI6WyJtb2R1bGVzL3NjaGVkdWxlci91dGlscy9jYWxlbmRhci1zY2hlZHVsZXItdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBZUEsc0ZBQXNGO0FBQ3RGLE9BQU8sS0FBSyxjQUFjLE1BQU0sUUFBUSxDQUFDO0FBQ3pDLE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQztBQUc5QixNQUFNLENBQU4sSUFBWSxZQVFYO0FBUkQsV0FBWSxZQUFZO0lBQ3BCLG1EQUFVLENBQUE7SUFDVixtREFBVSxDQUFBO0lBQ1YscURBQVcsQ0FBQTtJQUNYLHlEQUFhLENBQUE7SUFDYix1REFBWSxDQUFBO0lBQ1osbURBQVUsQ0FBQTtJQUNWLHVEQUFZLENBQUE7QUFDaEIsQ0FBQyxFQVJXLFlBQVksS0FBWixZQUFZLFFBUXZCO0FBRUQsTUFBTSxvQkFBb0IsR0FBYTtJQUNuQyxZQUFZLENBQUMsTUFBTTtJQUNuQixZQUFZLENBQUMsUUFBUTtDQUN4QixDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFXLENBQUMsQ0FBQztBQUN0QyxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQVcsRUFBRSxDQUFDO0FBQ3ZDLE1BQU0sQ0FBQyxNQUFNLGVBQWUsR0FBVyxFQUFFLENBQUM7QUFDMUMsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFXLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDO0FBRW5ELE1BQU0sQ0FBQyxNQUFNLDhCQUE4QixHQUFHLEVBQUUsQ0FBQztBQUNqRCxNQUFNLENBQUMsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLENBQUM7QUFDckMsTUFBTSxDQUFDLE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxDQUFDO0FBY3ZDLE1BQU0sVUFBVSx3QkFBd0IsQ0FDcEMsV0FBd0IsRUFDeEIsRUFDSSxRQUFRLEVBQ1Is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b0IsR0FBRyxhQUFhLENBQUMsS0FBSyxDQUFDLEVBQUU7c0JBQ3BLLHdCQUF3QixHQUFHLGdCQUFnQixHQUFHLDBCQUEwQixHQUFHLG1CQUFtQixHQUFHLDhEQUE4RCxDQUFDLENBQUM7YUFDMUs7WUFDRCxPQUFPLElBQUksQ0FBQztTQUNmO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBR0QsU0FBUyxhQUFhLENBQUMsS0FBYTtJQUNoQyxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDNUMsQ0FBQztBQUVELFNBQVMsZUFBZSxDQUFDLE9BQWU7SUFDcEMsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzlDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQ2FsZW5kYXJTY2hlZHVsZXJFdmVudCxcclxuICAgIFNjaGVkdWxlclZpZXdIb3VyLFxyXG4gICAgU2NoZWR1bGVyVmlld0RheSxcclxuICAgIFNjaGVkdWxlclZpZXdFdmVudCxcclxuICAgIFNjaGVkdWxlclZpZXdIb3VyU2VnbWVudCxcclxuICAgIFNjaGVkdWxlclZpZXcsXHJcbiAgICBTY2hlZHVsZXJWaWV3UGVyaW9kXHJcbn0gZnJvbSAnLi4vbW9kZWxzJztcclxuaW1wb3J0IHtcclxuICAgIFdlZWtWaWV3SG91cixcclxuICAgIFdlZWtWaWV3SG91clNlZ21lbnRcclxufSBmcm9tICdjYWxlbmRhci11dGlscyc7XHJcbmltcG9ydCB7IERhdGVBZGFwdGVyIH0gZnJvbSAnYW5ndWxhci1jYWxlbmRhcic7XHJcblxyXG4vLyBXT1JLQVJPVU5EOiBodHRwczovL2dpdGh1Yi5jb20vZGhlcmdlcy9uZy1wYWNrYWdyL2lzc3Vlcy8yMTcjaXNzdWVjb21tZW50LTMzOTQ2MDI1NVxyXG5pbXBvcnQgKiBhcyBtb21lbnRJbXBvcnRlZCBmcm9tICdtb21lbnQnO1xyXG5jb25zdCBtb21lbnQgPSBtb21lbnRJbXBvcnRlZDtcclxuXHJcblxyXG5leHBvcnQgZW51bSBEQVlTX09GX1dFRUsge1xyXG4gICAgU1VOREFZID0gMCxcclxuICAgIE1PTkRBWSA9IDEsXHJcbiAgICBUVUVTREFZID0gMixcclxuICAgIFdFRE5FU0RBWSA9IDMsXHJcbiAgICBUSFVSU0RBWSA9IDQsXHJcbiAgICBGUklEQVkgPSA1LFxyXG4gICAgU0FUVVJEQVkgPSA2XHJcbn1cclxuXHJcbmNvbnN0IERFRkFVTFRfV0VFS0VORF9EQVlTOiBudW1iZXJbXSA9IFtcclxuICAgIERBWVNfT0ZfV0VFSy5TVU5EQVksXHJcbiAgICBEQVlTX09GX1dFRUsuU0FUVVJEQVlcclxuXTtcclxuXHJcbmV4cG9ydCBjb25zdCBEQVlTX0lOX1dFRUs6IG51bWJlciA9IDc7XHJcbmV4cG9ydCBjb25zdCBIT1VSU19JTl9EQVk6IG51bWJlciA9IDI0O1xyXG5leHBvcnQgY29uc3QgTUlOVVRFU19JTl9IT1VSOiBudW1iZXIgPSA2MDtcclxuZXhwb3J0IGNvbnN0IFNFQ09ORFNfSU5fREFZOiBudW1iZXIgPSA2MCAqIDYwICogMjQ7XHJcblxyXG5leHBvcnQgY29uc3QgREVGQVVMVF9IT1VSX1NFR01FTlRfSEVJR0hUX1BYID0gNDA7XHJcbmV4cG9ydCBjb25zdCBERUZBVUxUX0VWRU5UX1dJRFRIID0gMTtcclxuZXhwb3J0IGNvbnN0IERFRkFVTFRfSE9VUl9TRUdNRU5UUyA9IDI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFRpbWUge1xyXG4gICAgaG91cjogbnVtYmVyO1xyXG4gICAgbWludXRlOiBudW1iZXI7XHJcbiAgfVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBHZXRTY2hlZHVsZXJWaWV3SG91ckdyaWRBcmdzIHtcclxuICAgIHZpZXdEYXRlOiBEYXRlO1xyXG4gICAgaG91clNlZ21lbnRzOiBudW1iZXI7XHJcbiAgICBkYXlTdGFydDogVGltZTtcclxuICAgIGRheUVuZDogVGltZTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFNjaGVkdWxlclZpZXdIb3VyR3JpZChcclxuICAgIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcixcclxuICAgIHtcclxuICAgICAgICB2aWV3RGF0ZSxcclxuICAgICAgICBob3VyU2VnbWVudHMsXHJcbiAgICAgICAgZGF5U3RhcnQsXHJcbiAgICAgICAgZGF5RW5kXHJcbiAgICB9OiBHZXRTY2hlZHVsZXJWaWV3SG91ckdyaWRBcmdzXHJcbik6IFdlZWtWaWV3SG91cltdIHtcclxuICAgIGNvbnN0IHtcclxuICAgICAgICBzZXRNaW51dGVzLFxyXG4gICAgICAgIHNldEhvdXJzLFxyXG4gICAgICAgIHN0YXJ0T2ZEYXksXHJcbiAgICAgICAgc3RhcnRPZk1pbnV0ZSxcclxuICAgICAgICBlbmRPZkRheSxcclxuICAgICAgICBhZGRNaW51dGVzLFxyXG4gICAgICAgIGFkZEhvdXJzLFxyXG4gICAgICAgIGFkZERheXNcclxuICAgICAgfSA9IGRhdGVBZGFwdGVyO1xyXG4gICAgY29uc3QgaG91cnM6IFdlZWtWaWV3SG91cltdID0gW107XHJcblxyXG4gICAgbGV0IHN0YXJ0T2ZWaWV3OiBEYXRlID0gc2V0TWludXRlcyhcclxuICAgICAgICBzZXRIb3VycyhzdGFydE9mRGF5KHZpZXdEYXRlKSwgc2FuaXRpc2VIb3VycyhkYXlTdGFydC5ob3VyKSksXHJcbiAgICAgICAgc2FuaXRpc2VNaW51dGVzKGRheVN0YXJ0Lm1pbnV0ZSlcclxuICAgICk7XHJcbiAgICBsZXQgZW5kT2ZWaWV3OiBEYXRlID0gc2V0TWludXRlcyhcclxuICAgICAgICBzZXRIb3VycyhzdGFydE9mTWludXRlKGVuZE9mRGF5KHZpZXdEYXRlKSksIHNhbml0aXNlSG91cnMoZGF5RW5kLmhvdXIpKSxcclxuICAgICAgICBzYW5pdGlzZU1pbnV0ZXMoZGF5RW5kLm1pbnV0ZSlcclxuICAgICk7XHJcbiAgICBjb25zdCBzZWdtZW50RHVyYXRpb246IG51bWJlciA9IE1JTlVURVNfSU5fSE9VUiAvIGhvdXJTZWdtZW50cztcclxuICAgIGxldCBzdGFydE9mVmlld0RheTogRGF0ZSA9IHN0YXJ0T2ZEYXkodmlld0RhdGUpO1xyXG4gICAgY29uc3QgZW5kT2ZWaWV3RGF5OiBEYXRlID0gZW5kT2ZEYXkodmlld0RhdGUpO1xyXG4gICAgbGV0IGRhdGVBZGp1c3RtZW50OiAoZDogRGF0ZSkgPT4gRGF0ZSA9IChkOiBEYXRlKSA9PiBkO1xyXG5cclxuICAgIC8vIHRoaXMgbWVhbnMgdGhhdCB3ZSBjaGFuZ2UgZnJvbSBvciB0byBEU1Qgb24gdGhpcyBkYXkgYW5kIHRoYXQncyBnb2luZyB0byBjYXVzZSBwcm9ibGVtcyBzbyB3ZSBidW1wIHRoZSBkYXRlXHJcbiAgICBpZiAoc3RhcnRPZlZpZXdEYXkuZ2V0VGltZXpvbmVPZmZzZXQoKSAhPT0gZW5kT2ZWaWV3RGF5LmdldFRpbWV6b25lT2Zmc2V0KCkpIHtcclxuICAgICAgICBzdGFydE9mVmlld0RheSA9IGFkZERheXMoc3RhcnRPZlZpZXdEYXksIDEpO1xyXG4gICAgICAgIHN0YXJ0T2ZWaWV3ID0gYWRkRGF5cyhzdGFydE9mVmlldywgMSk7XHJcbiAgICAgICAgZW5kT2ZWaWV3ID0gYWRkRGF5cyhlbmRPZlZpZXcsIDEpO1xyXG4gICAgICAgIGRhdGVBZGp1c3RtZW50ID0gKGQ6IERhdGUpID0+IGFkZERheXMoZCwgLTEpO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCBIT1VSU19JTl9EQVk7IGkrKykge1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IGk6IG51bWJlciA9IDA7IGkgPCBIT1VSU19JTl9EQVk7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IHNlZ21lbnRzOiBXZWVrVmlld0hvdXJTZWdtZW50W10gPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBqOiBudW1iZXIgPSAwOyBqIDwgaG91clNlZ21lbnRzOyBqKyspIHtcclxuICAgICAgICAgIGNvbnN0IGRhdGU6IERhdGUgPSBhZGRNaW51dGVzKFxyXG4gICAgICAgICAgICBhZGRIb3VycyhzdGFydE9mVmlld0RheSwgaSksXHJcbiAgICAgICAgICAgIGogKiBzZWdtZW50RHVyYXRpb25cclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBpZiAoZGF0ZSA+PSBzdGFydE9mVmlldyAmJiBkYXRlIDwgZW5kT2ZWaWV3KSB7XHJcbiAgICAgICAgICAgIHNlZ21lbnRzLnB1c2goe1xyXG4gICAgICAgICAgICAgIGRhdGU6IGRhdGVBZGp1c3RtZW50KGRhdGUpLFxyXG4gICAgICAgICAgICAgIGRpc3BsYXlEYXRlOiBkYXRlLFxyXG4gICAgICAgICAgICAgIGlzU3RhcnQ6IGogPT09IDBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzZWdtZW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBob3Vycy5wdXNoKHsgc2VnbWVudHMgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBob3VycztcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBHZXRTY2hlZHVsZXJWaWV3QXJncyB7XHJcbiAgICBldmVudHM/OiBDYWxlbmRhclNjaGVkdWxlckV2ZW50W107XHJcbiAgICB2aWV3RGF0ZTogRGF0ZTtcclxuICAgIHZpZXdEYXlzOiBudW1iZXI7XHJcbiAgICBob3VyU2VnbWVudHM6IDEgfCAyIHwgNCB8IDY7XHJcbiAgICB3ZWVrU3RhcnRzT246IG51bWJlcjtcclxuICAgIHN0YXJ0c1dpdGhUb2RheTogYm9vbGVhbjtcclxuICAgIGRheVN0YXJ0OiBUaW1lO1xyXG4gICAgZGF5RW5kOiBUaW1lO1xyXG4gICAgd2Vla2VuZERheXM/OiBudW1iZXJbXTtcclxuICAgIGV4Y2x1ZGVkPzogbnVtYmVyW107XHJcbiAgICBldmVudFdpZHRoOiBudW1iZXI7XHJcbiAgICBob3VyU2VnbWVudEhlaWdodDogbnVtYmVyO1xyXG4gICAgbG9nRW5hYmxlZD86IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRTY2hlZHVsZXJWaWV3KFxyXG4gICAgZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyLFxyXG4gICAge1xyXG4gICAgICAgIGV2ZW50cyA9IFtdLFxyXG4gICAgICAgIHZpZXdEYXRlLFxyXG4gICAgICAgIHZpZXdEYXlzLFxyXG4gICAgICAgIHdlZWtTdGFydHNPbixcclxuICAgICAgICBzdGFydHNXaXRoVG9kYXksXHJcbiAgICAgICAgZXhjbHVkZWQgPSBbXSxcclxuICAgICAgICBob3VyU2VnbWVudHMgPSBERUZBVUxUX0hPVVJfU0VHTUVOVFMsXHJcbiAgICAgICAgZGF5U3RhcnQsXHJcbiAgICAgICAgZGF5RW5kLFxyXG4gICAgICAgIHdlZWtlbmREYXlzID0gREVGQVVMVF9XRUVLRU5EX0RBWVMsXHJcbiAgICAgICAgaG91clNlZ21lbnRIZWlnaHQgPSBERUZBVUxUX0hPVVJfU0VHTUVOVF9IRUlHSFRfUFgsXHJcbiAgICAgICAgZXZlbnRXaWR0aCA9IERFRkFVTFRfRVZFTlRfV0lEVEgsXHJcbiAgICAgICAgbG9nRW5hYmxlZCxcclxuICAgIH06IEdldFNjaGVkdWxlclZpZXdBcmdzXHJcbik6IFNjaGVkdWxlclZpZXcge1xyXG4gICAgaWYgKCFldmVudHMpIHsgZXZlbnRzID0gW107IH1cclxuXHJcbiAgICBjb25zdCB7IGFkZERheXMsIHN0YXJ0T2ZEYXksIGVuZE9mRGF5LCBzdGFydE9mV2VlaywgZW5kT2ZXZWVrIH0gPSBkYXRlQWRhcHRlcjtcclxuICAgIGNvbnN0IHN0YXJ0T2ZWaWV3V2VlazogRGF0ZSA9IHN0YXJ0c1dpdGhUb2RheSB8fCB2aWV3RGF5cyA8IERBWVNfSU5fV0VFSyA/IHN0YXJ0T2ZEYXkodmlld0RhdGUpIDogc3RhcnRPZldlZWsodmlld0RhdGUsIHsgd2Vla1N0YXJ0c09uOiB3ZWVrU3RhcnRzT24gfSk7XHJcbiAgICBjb25zdCBlbmRPZlZpZXdXZWVrOiBEYXRlID0gc3RhcnRzV2l0aFRvZGF5IHx8IHZpZXdEYXlzIDwgREFZU19JTl9XRUVLID8gYWRkRGF5cyhlbmRPZkRheSh2aWV3RGF0ZSksIHZpZXdEYXlzIC0gMSkgOiBlbmRPZldlZWsodmlld0RhdGUsIHsgd2Vla1N0YXJ0c09uOiB3ZWVrU3RhcnRzT24gfSk7XHJcblxyXG4gICAgY29uc3QgZXZlbnRzSW5XZWVrOiBDYWxlbmRhclNjaGVkdWxlckV2ZW50W10gPSBnZXRFdmVudHNJblBlcmlvZChkYXRlQWRhcHRlciwge1xyXG4gICAgICAgIGV2ZW50czogZXZlbnRzLFxyXG4gICAgICAgIHBlcmlvZFN0YXJ0OiBzdGFydE9mVmlld1dlZWssXHJcbiAgICAgICAgcGVyaW9kRW5kOiBlbmRPZlZpZXdXZWVrXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBkYXlzOiBTY2hlZHVsZXJWaWV3RGF5W10gPSBnZXRTY2hlZHVsZXJWaWV3RGF5cyhkYXRlQWRhcHRlciwge1xyXG4gICAgICAgIHZpZXdEYXRlOiB2aWV3RGF0ZSxcclxuICAgICAgICB2aWV3RGF5czogdmlld0RheXMsXHJcbiAgICAgICAgd2Vla1N0YXJ0c09uOiB3ZWVrU3RhcnRzT24sXHJcbiAgICAgICAgc3RhcnRzV2l0aFRvZGF5OiBzdGFydHNXaXRoVG9kYXksXHJcbiAgICAgICAgZXhjbHVkZWQ6IGV4Y2x1ZGVkLFxyXG4gICAgICAgIHdlZWtlbmREYXlzOiB3ZWVrZW5kRGF5c1xyXG4gICAgfSk7XHJcbiAgICBkYXlzLmZvckVhY2goKGRheTogU2NoZWR1bGVyVmlld0RheSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0T2ZWaWV3OiBEYXRlID0gZGF0ZUFkYXB0ZXIuc2V0TWludXRlcyhkYXRlQWRhcHRlci5zZXRIb3VycyhkYXRlQWRhcHRlci5zdGFydE9mRGF5KGRheS5kYXRlKSwgZGF5U3RhcnQuaG91ciksIGRheVN0YXJ0Lm1pbnV0ZSk7XHJcbiAgICAgICAgY29uc3QgZW5kT2ZWaWV3OiBEYXRlID0gZGF0ZUFkYXB0ZXIuc2V0TWludXRlcyhkYXRlQWRhcHRlci5zZXRIb3VycyhkYXRlQWRhcHRlci5zdGFydE9mTWludXRlKGRhdGVBZGFwdGVyLmVuZE9mRGF5KGRheS5kYXRlKSksIGRheUVuZC5ob3VyKSwgZGF5RW5kLm1pbnV0ZSk7XHJcbiAgICAgICAgY29uc3QgcHJldmlvdXNEYXlFdmVudHM6IFNjaGVkdWxlclZpZXdFdmVudFtdID0gW107XHJcblxyXG4gICAgICAgIGNvbnN0IGV2ZW50c0luRGF5OiBDYWxlbmRhclNjaGVkdWxlckV2ZW50W10gPSBnZXRFdmVudHNJblBlcmlvZChkYXRlQWRhcHRlciwge1xyXG4gICAgICAgICAgICBldmVudHM6IGV2ZW50c0luV2VlayxcclxuICAgICAgICAgICAgcGVyaW9kU3RhcnQ6IHN0YXJ0T2ZWaWV3LFxyXG4gICAgICAgICAgICBwZXJpb2RFbmQ6IGVuZE9mVmlld1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBkYXlFdmVudHMgPSBldmVudHNJbkRheVxyXG4gICAgICAgICAgICAuc29ydCgoZXZlbnRBOiBDYWxlbmRhclNjaGVkdWxlckV2ZW50LCBldmVudEI6IENhbGVuZGFyU2NoZWR1bGVyRXZlbnQpID0+IGV2ZW50QS5zdGFydC52YWx1ZU9mKCkgLSBldmVudEIuc3RhcnQudmFsdWVPZigpKVxyXG4gICAgICAgICAgICAubWFwKChldjogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnRTdGFydDogRGF0ZSA9IGV2LnN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnRFbmQ6IERhdGUgPSBldi5lbmQgfHwgZXZlbnRTdGFydDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0c0JlZm9yZURheTogYm9vbGVhbiA9IGV2ZW50U3RhcnQgPCBzdGFydE9mVmlldztcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVuZHNBZnRlckRheTogYm9vbGVhbiA9IGRhdGVBZGFwdGVyLmFkZE1pbnV0ZXMoZXZlbnRFbmQsIC0xKSA+IGVuZE9mVmlldztcclxuICAgICAgICAgICAgICAgIGNvbnN0IGhvdXJIZWlnaHRNb2RpZmllcjogbnVtYmVyID0gKChob3VyU2VnbWVudHMgKiBob3VyU2VnbWVudEhlaWdodCkgKyAxKSAvIE1JTlVURVNfSU5fSE9VUjsgLy8gKzEgZm9yIHRoZSAxcHggc2VnbWVudCBib3R0b20gYm9yZGVyXHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHRvcDogbnVtYmVyID0gMDtcclxuICAgICAgICAgICAgICAgIGlmIChldmVudFN0YXJ0ID4gc3RhcnRPZlZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0b3AgKz0gZGF0ZUFkYXB0ZXIuZGlmZmVyZW5jZUluTWludXRlcyhldmVudFN0YXJ0LCBzdGFydE9mVmlldyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0b3AgKj0gaG91ckhlaWdodE1vZGlmaWVyO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RGF0ZTogRGF0ZSA9IHN0YXJ0c0JlZm9yZURheSA/IHN0YXJ0T2ZWaWV3IDogZXZlbnRTdGFydDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGVuZERhdGU6IERhdGUgPSBlbmRzQWZ0ZXJEYXkgPyBlbmRPZlZpZXcgOiBldmVudEVuZDtcclxuICAgICAgICAgICAgICAgIGxldCBoZWlnaHQ6IG51bWJlciA9IGRhdGVBZGFwdGVyLmRpZmZlcmVuY2VJbk1pbnV0ZXMoZW5kRGF0ZSwgc3RhcnREYXRlKTtcclxuICAgICAgICAgICAgICAgIGlmICghZXYuZW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gaG91clNlZ21lbnRIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGhlaWdodCAqPSBob3VySGVpZ2h0TW9kaWZpZXI7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgYm90dG9tOiBudW1iZXIgPSB0b3AgKyBoZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBvdmVybGFwcGluZ1ByZXZpb3VzRXZlbnRzID0gZ2V0T3ZlckxhcHBpbmdFdmVudHMoXHJcbiAgICAgICAgICAgICAgICAgICAgZXYsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNEYXlFdmVudHMsXHJcbiAgICAgICAgICAgICAgICAgICAgdG9wLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvdHRvbSxcclxuICAgICAgICAgICAgICAgICAgICBsb2dFbmFibGVkXHJcbiAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBsZWZ0OiBudW1iZXIgPSAwO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKG92ZXJsYXBwaW5nUHJldmlvdXNFdmVudHMuc29tZShwcmV2aW91c0V2ZW50ID0+IHByZXZpb3VzRXZlbnQubGVmdCA9PT0gbGVmdCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZWZ0ICs9IGV2ZW50V2lkdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnQ6IFNjaGVkdWxlclZpZXdFdmVudCA9XHJcbiAgICAgICAgICAgICAgICAgICAgPFNjaGVkdWxlclZpZXdFdmVudD57XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50OiBldixcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB0b3AsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZXZlbnRXaWR0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogbGVmdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRzQmVmb3JlRGF5OiBzdGFydHNCZWZvcmVEYXksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZHNBZnRlckRheTogZW5kc0FmdGVyRGF5XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBwcmV2aW91c0RheUV2ZW50cy5wdXNoKGV2ZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXZlbnQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRDb2x1bW5Db3VudChcclxuICAgICAgICAgICAgYWxsRXZlbnRzOiBTY2hlZHVsZXJWaWV3RXZlbnRbXSxcclxuICAgICAgICAgICAgcHJldk92ZXJsYXBwaW5nRXZlbnRzOiBTY2hlZHVsZXJWaWV3RXZlbnRbXVxyXG4gICAgICAgICk6IG51bWJlciB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbkNvdW50ID0gTWF0aC5tYXgoXHJcbiAgICAgICAgICAgICAgICAuLi5wcmV2T3ZlcmxhcHBpbmdFdmVudHMubWFwKChldjogU2NoZWR1bGVyVmlld0V2ZW50KSA9PiBldi5sZWZ0ICsgMSlcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IG5leHRPdmVybGFwcGluZ0V2ZW50cyA9IGFsbEV2ZW50c1xyXG4gICAgICAgICAgICAgICAgLmZpbHRlcigoZXY6IFNjaGVkdWxlclZpZXdFdmVudCkgPT4gZXYubGVmdCA+PSBjb2x1bW5Db3VudClcclxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKGV2OiBTY2hlZHVsZXJWaWV3RXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRPdmVyTGFwcGluZ0V2ZW50cyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldk92ZXJsYXBwaW5nRXZlbnRzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXYudG9wLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXYudG9wICsgZXYuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRW5hYmxlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICApLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChuZXh0T3ZlcmxhcHBpbmdFdmVudHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGdldENvbHVtbkNvdW50KGFsbEV2ZW50cywgbmV4dE92ZXJsYXBwaW5nRXZlbnRzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2x1bW5Db3VudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbWFwcGVkRXZlbnRzID0gZGF5RXZlbnRzLm1hcChldmVudCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbkNvdW50ID0gZ2V0Q29sdW1uQ291bnQoXHJcbiAgICAgICAgICAgICAgICBkYXlFdmVudHMsXHJcbiAgICAgICAgICAgICAgICBnZXRPdmVyTGFwcGluZ0V2ZW50cyhcclxuICAgICAgICAgICAgICAgICAgICBldmVudCxcclxuICAgICAgICAgICAgICAgICAgICBkYXlFdmVudHMsXHJcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQudG9wLFxyXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnRvcCArIGV2ZW50LmhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICBsb2dFbmFibGVkXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCB3aWR0aCA9IDEwMCAvIGNvbHVtbkNvdW50O1xyXG4gICAgICAgICAgICByZXR1cm4geyAuLi5ldmVudCwgbGVmdDogZXZlbnQubGVmdCAqIHdpZHRoLCB3aWR0aCB9O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkYXkuZXZlbnRzID0gbWFwcGVkRXZlbnRzLm1hcChldmVudCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG92ZXJMYXBwaW5nRXZlbnRzID0gZ2V0T3ZlckxhcHBpbmdFdmVudHMoZXZlbnQsXHJcbiAgICAgICAgICAgICAgbWFwcGVkRXZlbnRzLmZpbHRlcihvdGhlckV2ZW50ID0+IG90aGVyRXZlbnQubGVmdCA+IGV2ZW50LmxlZnQpLFxyXG4gICAgICAgICAgICAgIGV2ZW50LnRvcCxcclxuICAgICAgICAgICAgICBldmVudC50b3AgKyBldmVudC5oZWlnaHQsXHJcbiAgICAgICAgICAgICAgbG9nRW5hYmxlZFxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxvZ0VuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFxyXG4gICAgICAgICAgICAgICAgICAgIGBEQVkgWyR7bW9tZW50KGRheS5kYXRlKS5mb3JtYXQoJ2RkZGQgTCcpfV0gYCArXHJcbiAgICAgICAgICAgICAgICAgICAgYC0gRVZFTlQgJHtldmVudC5ldmVudC5pZH0gWyR7bW9tZW50KGV2ZW50LmV2ZW50LnN0YXJ0KS5mb3JtYXQoJ2RkZGQgTCwgTFRTJyl9IGAgK1xyXG4gICAgICAgICAgICAgICAgICAgIGAtICR7bW9tZW50KGV2ZW50LmV2ZW50LmVuZCkuZm9ybWF0KCdkZGRkIEwsIExUUycpfV0gb3ZlckxhcHBpbmdFdmVudHMgLT4gYCxcclxuICAgICAgICAgICAgICAgICAgICBvdmVyTGFwcGluZ0V2ZW50c1xyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG92ZXJMYXBwaW5nRXZlbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgLi4uZXZlbnQsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDpcclxuICAgICAgICAgICAgICAgICAgTWF0aC5taW4oXHJcbiAgICAgICAgICAgICAgICAgICAgLi4ub3ZlckxhcHBpbmdFdmVudHMubWFwKG90aGVyRXZlbnQgPT4gb3RoZXJFdmVudC5sZWZ0KVxyXG4gICAgICAgICAgICAgICAgICApIC0gZXZlbnQubGVmdFxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGV2ZW50O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkYXkuaG91cnMgPSBnZXRTY2hlZHVsZXJWaWV3SG91ckdyaWQoZGF0ZUFkYXB0ZXIsIHtcclxuICAgICAgICAgICAgdmlld0RhdGU6IHZpZXdEYXRlLFxyXG4gICAgICAgICAgICBob3VyU2VnbWVudHM6IGhvdXJTZWdtZW50cyxcclxuICAgICAgICAgICAgZGF5U3RhcnQ6IHtcclxuICAgICAgICAgICAgICAgIGhvdXI6IGRheVN0YXJ0LmhvdXIsXHJcbiAgICAgICAgICAgICAgICBtaW51dGU6IGRheVN0YXJ0Lm1pbnV0ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBkYXlFbmQ6IHtcclxuICAgICAgICAgICAgICAgIGhvdXI6IGRheUVuZC5ob3VyLFxyXG4gICAgICAgICAgICAgICAgbWludXRlOiBkYXlFbmQubWludXRlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KS5tYXAoKGhvdXI6IFdlZWtWaWV3SG91cikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlOiBEYXRlID0gbmV3IERhdGUoZGF5LmRhdGUuZ2V0RnVsbFllYXIoKSwgZGF5LmRhdGUuZ2V0TW9udGgoKSwgZGF5LmRhdGUuZ2V0RGF0ZSgpLCBob3VyLnNlZ21lbnRzWzBdLmRhdGUuZ2V0SG91cnMoKSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzdGFydE9mSG91cjogRGF0ZSA9IG5ldyBEYXRlKGRheS5kYXRlLmdldEZ1bGxZZWFyKCksIGRheS5kYXRlLmdldE1vbnRoKCksIGRheS5kYXRlLmdldERhdGUoKSwgaG91ci5zZWdtZW50c1swXS5kYXRlLmdldEhvdXJzKCkpO1xyXG4gICAgICAgICAgICBjb25zdCBlbmRPZkhvdXI6IERhdGUgPSBkYXRlQWRhcHRlci5hZGRTZWNvbmRzKGRhdGVBZGFwdGVyLmFkZEhvdXJzKHN0YXJ0T2ZIb3VyLCAxKSwgLTEpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZXZlbnRzSW5Ib3VyOiBTY2hlZHVsZXJWaWV3RXZlbnRbXSA9IGdldFNjaGVkdWxlckV2ZW50c0luUGVyaW9kKGRhdGVBZGFwdGVyLCB7XHJcbiAgICAgICAgICAgICAgICBldmVudHM6IGRheS5ldmVudHMsXHJcbiAgICAgICAgICAgICAgICBwZXJpb2RTdGFydDogc3RhcnRPZkhvdXIsXHJcbiAgICAgICAgICAgICAgICBwZXJpb2RFbmQ6IGVuZE9mSG91clxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNlZ21lbnRzOiBTY2hlZHVsZXJWaWV3SG91clNlZ21lbnRbXSA9XHJcbiAgICAgICAgICAgICAgICBob3VyLnNlZ21lbnRzLm1hcCgoc2VnbWVudDogV2Vla1ZpZXdIb3VyU2VnbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlZ21lbnQuZGF0ZSA9IGRhdGVBZGFwdGVyLnNldERhdGUoZGF0ZUFkYXB0ZXIuc2V0TW9udGgoZGF0ZUFkYXB0ZXIuc2V0WWVhcihzZWdtZW50LmRhdGUsIGRheS5kYXRlLmdldEZ1bGxZZWFyKCkpLCBkYXkuZGF0ZS5nZXRNb250aCgpKSwgZGF5LmRhdGUuZ2V0RGF0ZSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRPZlNlZ21lbnQ6IERhdGUgPSBzZWdtZW50LmRhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kT2ZTZWdtZW50OiBEYXRlID0gZGF0ZUFkYXB0ZXIuYWRkU2Vjb25kcyhkYXRlQWRhcHRlci5hZGRNaW51dGVzKHN0YXJ0T2ZTZWdtZW50LCBNSU5VVEVTX0lOX0hPVVIgLyBob3VyU2VnbWVudHMpLCAtMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50c0luU2VnbWVudDogU2NoZWR1bGVyVmlld0V2ZW50W10gPSBnZXRTY2hlZHVsZXJFdmVudHNJblBlcmlvZChkYXRlQWRhcHRlciwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudHM6IGV2ZW50c0luSG91cixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGVyaW9kU3RhcnQ6IHN0YXJ0T2ZTZWdtZW50LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwZXJpb2RFbmQ6IGVuZE9mU2VnbWVudFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAobG9nRW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBTRUdNRU5UIFske21vbWVudChzdGFydE9mU2VnbWVudCkuZm9ybWF0KCdkZGRkIEwsIExUUycpfSAtICR7bW9tZW50KGVuZE9mU2VnbWVudCkuZm9ybWF0KCdkZGRkIEwsIExUUycpfV0gRVZFTlRTIC0+IGAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudHNJblNlZ21lbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA8U2NoZWR1bGVyVmlld0hvdXJTZWdtZW50PntcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VnbWVudDogc2VnbWVudCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoc2VnbWVudC5kYXRlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRzOiBldmVudHNJblNlZ21lbnRcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gPFNjaGVkdWxlclZpZXdIb3VyPntcclxuICAgICAgICAgICAgICAgIGhvdXI6IGhvdXIsXHJcbiAgICAgICAgICAgICAgICBkYXRlOiBkYXRlLFxyXG4gICAgICAgICAgICAgICAgZXZlbnRzOiBldmVudHNJbkhvdXIsXHJcbiAgICAgICAgICAgICAgICBzZWdtZW50czogc2VnbWVudHNcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiA8U2NoZWR1bGVyVmlldz57XHJcbiAgICAgICAgZGF5czogZGF5cyxcclxuICAgICAgICBwZXJpb2Q6IDxTY2hlZHVsZXJWaWV3UGVyaW9kPntcclxuICAgICAgICAgICAgZXZlbnRzOiBldmVudHNJbldlZWssXHJcbiAgICAgICAgICAgIHN0YXJ0OiBzdGFydE9mVmlld1dlZWssXHJcbiAgICAgICAgICAgIGVuZDogZW5kT2ZWaWV3V2Vla1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgR2V0U2NoZWR1bGVyVmlld0RheXNBcmdzIHtcclxuICAgIHZpZXdEYXRlOiBEYXRlO1xyXG4gICAgdmlld0RheXM6IG51bWJlcjtcclxuICAgIHdlZWtTdGFydHNPbjogbnVtYmVyO1xyXG4gICAgc3RhcnRzV2l0aFRvZGF5OiBib29sZWFuO1xyXG4gICAgZXhjbHVkZWQ/OiBudW1iZXJbXTtcclxuICAgIHdlZWtlbmREYXlzPzogbnVtYmVyW107XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRTY2hlZHVsZXJWaWV3RGF5cyhcclxuICAgIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcixcclxuICAgIHtcclxuICAgICAgICB2aWV3RGF0ZSxcclxuICAgICAgICB2aWV3RGF5cyxcclxuICAgICAgICB3ZWVrU3RhcnRzT24sXHJcbiAgICAgICAgc3RhcnRzV2l0aFRvZGF5LFxyXG4gICAgICAgIGV4Y2x1ZGVkID0gW10sXHJcbiAgICAgICAgd2Vla2VuZERheXMgPSBERUZBVUxUX1dFRUtFTkRfREFZU1xyXG4gICAgfTogR2V0U2NoZWR1bGVyVmlld0RheXNBcmdzXHJcbik6IFNjaGVkdWxlclZpZXdEYXlbXSB7XHJcbiAgICBjb25zdCBzdGFydCA9IHN0YXJ0c1dpdGhUb2RheSB8fCB2aWV3RGF5cyA8IERBWVNfSU5fV0VFS1xyXG4gICAgICAgID8gbmV3IERhdGUodmlld0RhdGUpXHJcbiAgICAgICAgOiBkYXRlQWRhcHRlci5zdGFydE9mV2Vlayh2aWV3RGF0ZSwgeyB3ZWVrU3RhcnRzT246IHdlZWtTdGFydHNPbiB9KTtcclxuICAgIGNvbnN0IGRheXM6IFNjaGVkdWxlclZpZXdEYXlbXSA9IFtdO1xyXG4gICAgY29uc3QgbG9vcCA9IChpOiBudW1iZXIpID0+IHtcclxuICAgICAgICBjb25zdCBkYXRlID0gZGF0ZUFkYXB0ZXIuYWRkRGF5cyhzdGFydCwgaSk7XHJcbiAgICAgICAgaWYgKCFleGNsdWRlZC5zb21lKChlOiBudW1iZXIpID0+IGRhdGUuZ2V0RGF5KCkgPT09IGUpKSB7XHJcbiAgICAgICAgICAgIGRheXMucHVzaChnZXRTY2hlZHVsZXJEYXkoZGF0ZUFkYXB0ZXIsIHsgZGF0ZSwgd2Vla2VuZERheXMgfSkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZpZXdEYXlzOyBpKyspIHtcclxuICAgICAgICBsb29wKGkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRheXM7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFNjaGVkdWxlckRheShkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXIsIGFyZ3M6IHsgZGF0ZTogRGF0ZSwgd2Vla2VuZERheXM6IG51bWJlcltdIH0pOiBTY2hlZHVsZXJWaWV3RGF5IHtcclxuICAgIGNvbnN0IGRhdGU6IERhdGUgPSBhcmdzLmRhdGU7XHJcbiAgICBjb25zdCB0b2RheTogRGF0ZSA9IGRhdGVBZGFwdGVyLnN0YXJ0T2ZEYXkobmV3IERhdGUoKSk7XHJcblxyXG4gICAgcmV0dXJuIDxTY2hlZHVsZXJWaWV3RGF5PntcclxuICAgICAgICBkYXRlOiBkYXRlLFxyXG4gICAgICAgIGlzUGFzdDogZGF0ZSA8IHRvZGF5LFxyXG4gICAgICAgIGlzVG9kYXk6IGRhdGVBZGFwdGVyLmlzU2FtZURheShkYXRlLCB0b2RheSksXHJcbiAgICAgICAgaXNGdXR1cmU6IGRhdGUgPj0gZGF0ZUFkYXB0ZXIuYWRkRGF5cyh0b2RheSwgMSksXHJcbiAgICAgICAgaXNXZWVrZW5kOiBhcmdzLndlZWtlbmREYXlzLmluZGV4T2YoZGF0ZUFkYXB0ZXIuZ2V0RGF5KGRhdGUpKSA+IC0xLFxyXG4gICAgICAgIGluTW9udGg6IGRhdGVBZGFwdGVyLmlzU2FtZU1vbnRoKGRhdGUsIHRvZGF5KSxcclxuICAgICAgICBob3VyczogW11cclxuICAgIH07XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgR2V0RXZlbnRzSW5QZXJpb2RBcmdzIHtcclxuICAgIGV2ZW50czogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudFtdO1xyXG4gICAgcGVyaW9kU3RhcnQ6IERhdGU7XHJcbiAgICBwZXJpb2RFbmQ6IERhdGU7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEV2ZW50c0luUGVyaW9kKFxyXG4gICAgZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyLFxyXG4gICAge1xyXG4gICAgICAgIGV2ZW50cyxcclxuICAgICAgICBwZXJpb2RTdGFydCxcclxuICAgICAgICBwZXJpb2RFbmRcclxuICAgIH06IEdldEV2ZW50c0luUGVyaW9kQXJnc1xyXG4pOiBDYWxlbmRhclNjaGVkdWxlckV2ZW50W10ge1xyXG4gICAgcmV0dXJuIGV2ZW50cy5maWx0ZXIoKGV2ZW50KSA9PiBpc0V2ZW50SW5QZXJpb2QoZGF0ZUFkYXB0ZXIsIHsgZXZlbnQ6IGV2ZW50LCBwZXJpb2RTdGFydDogcGVyaW9kU3RhcnQsIHBlcmlvZEVuZDogcGVyaW9kRW5kIH0pKTtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBHZXRTY2hlZHVsZXJFdmVudHNJblBlcmlvZEFyZ3Mge1xyXG4gICAgZXZlbnRzOiBTY2hlZHVsZXJWaWV3RXZlbnRbXTtcclxuICAgIHBlcmlvZFN0YXJ0OiBEYXRlO1xyXG4gICAgcGVyaW9kRW5kOiBEYXRlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRTY2hlZHVsZXJFdmVudHNJblBlcmlvZChcclxuICAgIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcixcclxuICAgIHtcclxuICAgICAgICBldmVudHMsXHJcbiAgICAgICAgcGVyaW9kU3RhcnQsXHJcbiAgICAgICAgcGVyaW9kRW5kXHJcbiAgICB9OiBHZXRTY2hlZHVsZXJFdmVudHNJblBlcmlvZEFyZ3NcclxuKTogU2NoZWR1bGVyVmlld0V2ZW50W10ge1xyXG4gICAgcmV0dXJuIGV2ZW50cy5maWx0ZXIoKGV2ZW50KSA9PiBpc0V2ZW50SW5QZXJpb2QoZGF0ZUFkYXB0ZXIsIHsgZXZlbnQ6IGV2ZW50LmV2ZW50LCBwZXJpb2RTdGFydDogcGVyaW9kU3RhcnQsIHBlcmlvZEVuZDogcGVyaW9kRW5kIH0pKTtcclxufVxyXG5cclxuaW50ZXJmYWNlIElzRXZlbnRJblBlcmlvZEFyZ3Mge1xyXG4gICAgZXZlbnQ6IENhbGVuZGFyU2NoZWR1bGVyRXZlbnQ7XHJcbiAgICBwZXJpb2RTdGFydDogRGF0ZTtcclxuICAgIHBlcmlvZEVuZDogRGF0ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNFdmVudEluUGVyaW9kKGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlciwgeyBldmVudCwgcGVyaW9kU3RhcnQsIHBlcmlvZEVuZH06IElzRXZlbnRJblBlcmlvZEFyZ3MpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IHsgaXNTYW1lU2Vjb25kLCBhZGRTZWNvbmRzIH0gPSBkYXRlQWRhcHRlcjtcclxuICAgIGNvbnN0IGV2ZW50U3RhcnQ6IERhdGUgPSBldmVudC5zdGFydDtcclxuICAgIGNvbnN0IGV2ZW50RW5kOiBEYXRlID0gZXZlbnQuZW5kIHx8IGV2ZW50LnN0YXJ0O1xyXG5cclxuICAgIGlmIChldmVudFN0YXJ0ID4gcGVyaW9kU3RhcnQgJiYgZXZlbnRTdGFydCA8IHBlcmlvZEVuZCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChldmVudEVuZCA+IHBlcmlvZFN0YXJ0ICYmIGV2ZW50RW5kIDwgcGVyaW9kRW5kKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGV2ZW50U3RhcnQgPCBwZXJpb2RTdGFydCAmJiBldmVudEVuZCA+IHBlcmlvZEVuZCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpc1NhbWVTZWNvbmQoZXZlbnRTdGFydCwgcGVyaW9kU3RhcnQpIHx8IGlzU2FtZVNlY29uZChldmVudFN0YXJ0LCBwZXJpb2RFbmQpKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGlzU2FtZVNlY29uZChhZGRTZWNvbmRzKGV2ZW50RW5kLCAtMSksIHBlcmlvZFN0YXJ0KSB8fCBpc1NhbWVTZWNvbmQoYWRkU2Vjb25kcyhldmVudEVuZCwgLTEpLCBwZXJpb2RFbmQpKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gZ2V0T3ZlckxhcHBpbmdFdmVudHMoZXZlbnQ6IGFueS8qU2NoZWR1bGVyVmlld0V2ZW50IHwgQ2FsZW5kYXJTY2hlZHVsZXJFdmVudCovLCBldmVudHM6IFNjaGVkdWxlclZpZXdFdmVudFtdLCB0b3A6IG51bWJlciwgYm90dG9tOiBudW1iZXIsIGxvZ0VuYWJsZWQ6IGJvb2xlYW4gPSBmYWxzZSk6IFNjaGVkdWxlclZpZXdFdmVudFtdIHtcclxuICAgIHJldHVybiBldmVudHMuZmlsdGVyKChwcmV2aW91c0V2ZW50OiBTY2hlZHVsZXJWaWV3RXZlbnQpID0+IHtcclxuICAgICAgICB0b3AgPSBNYXRoLnJvdW5kKHRvcCk7XHJcbiAgICAgICAgYm90dG9tID0gTWF0aC5yb3VuZChib3R0b20pO1xyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzRXZlbnRUb3A6IG51bWJlciA9IE1hdGguZmxvb3IocHJldmlvdXNFdmVudC50b3ApO1xyXG4gICAgICAgIGNvbnN0IHByZXZpb3VzRXZlbnRCb3R0b206IG51bWJlciA9IE1hdGguZmxvb3IocHJldmlvdXNFdmVudC50b3AgKyBwcmV2aW91c0V2ZW50LmhlaWdodCk7XHJcblxyXG4gICAgICAgIGlmICh0b3AgPCBwcmV2aW91c0V2ZW50Qm90dG9tICYmIHByZXZpb3VzRXZlbnRCb3R0b20gPCBib3R0b20pIHtcclxuICAgICAgICAgICAgaWYgKGxvZ0VuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbZ2V0T3ZlckxhcHBpbmdFdmVudHNdIC0gRVZFTlQgJyArIChldmVudC5ldmVudD8uaWQgfHwgZXZlbnQuaWQpICsgJyAtPiB0b3A6ICcgKyB0b3AgKyAnIC0gYm90dG9tOiAnICsgYm90dG9tICsgJyB8IFBSRVZJT1VTIEVWRU5UICcgKyBwcmV2aW91c0V2ZW50LmV2ZW50LmlkXHJcbiAgICAgICAgICAgICAgICAgICAgKyAnIC0+IHByZXZpb3VzRXZlbnRUb3A6ICcgKyBwcmV2aW91c0V2ZW50VG9wICsgJyAtIHByZXZpb3VzRXZlbnRCb3R0b206ICcgKyBwcmV2aW91c0V2ZW50Qm90dG9tICsgJyAtPiB0b3AgPCBwcmV2aW91c0V2ZW50Qm90dG9tICYmIHByZXZpb3VzRXZlbnRCb3R0b20gPCBib3R0b20nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKHRvcCA8IHByZXZpb3VzRXZlbnRUb3AgJiYgcHJldmlvdXNFdmVudFRvcCA8IGJvdHRvbSkge1xyXG4gICAgICAgICAgICBpZiAobG9nRW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1tnZXRPdmVyTGFwcGluZ0V2ZW50c10gLSBFVkVOVCAnICsgKGV2ZW50LmV2ZW50Py5pZCB8fCBldmVudC5pZCkgKyAnIC0+IHRvcDogJyArIHRvcCArICcgLSBib3R0b206ICcgKyBib3R0b20gKyAnIHwgUFJFVklPVVMgRVZFTlQgJyArIHByZXZpb3VzRXZlbnQuZXZlbnQuaWRcclxuICAgICAgICAgICAgICAgICAgICArICcgLT4gcHJldmlvdXNFdmVudFRvcDogJyArIHByZXZpb3VzRXZlbnRUb3AgKyAnIC0gcHJldmlvdXNFdmVudEJvdHRvbTogJyArIHByZXZpb3VzRXZlbnRCb3R0b20gKyAnIC0+IHRvcCA8IHByZXZpb3VzRXZlbnRUb3AgJiYgcHJldmlvdXNFdmVudFRvcCA8IGJvdHRvbScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocHJldmlvdXNFdmVudFRvcCA8PSB0b3AgJiYgYm90dG9tIDw9IHByZXZpb3VzRXZlbnRCb3R0b20pIHtcclxuICAgICAgICAgICAgaWYgKGxvZ0VuYWJsZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdbZ2V0T3ZlckxhcHBpbmdFdmVudHNdIC0gRVZFTlQgJyArIChldmVudC5ldmVudD8uaWQgfHwgZXZlbnQuaWQpICsgJyAtPiB0b3A6ICcgKyB0b3AgKyAnIC0gYm90dG9tOiAnICsgYm90dG9tICsgJyB8IFBSRVZJT1VTIEVWRU5UICcgKyBwcmV2aW91c0V2ZW50LmV2ZW50LmlkXHJcbiAgICAgICAgICAgICAgICAgICAgKyAnIC0+IHByZXZpb3VzRXZlbnRUb3A6ICcgKyBwcmV2aW91c0V2ZW50VG9wICsgJyAtIHByZXZpb3VzRXZlbnRCb3R0b206ICcgKyBwcmV2aW91c0V2ZW50Qm90dG9tICsgJyAtPiBwcmV2aW91c0V2ZW50VG9wIDw9IHRvcCAmJiBib3R0b20gPD0gcHJldmlvdXNFdmVudEJvdHRvbScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBzYW5pdGlzZUhvdXJzKGhvdXJzOiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIE1hdGgubWF4KE1hdGgubWluKDIzLCBob3VycyksIDApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBzYW5pdGlzZU1pbnV0ZXMobWludXRlczogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgIHJldHVybiBNYXRoLm1heChNYXRoLm1pbig1OSwgbWludXRlcyksIDApO1xyXG59XHJcbiJdfQ==