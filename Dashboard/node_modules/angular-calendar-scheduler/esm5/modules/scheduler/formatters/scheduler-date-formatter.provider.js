import { __extends } from "tslib";
import { CalendarDateFormatter, DateFormatterParams, DateAdapter } from 'angular-calendar';
import { DAYS_IN_WEEK } from '../utils/calendar-scheduler-utils';
import { Injectable } from '@angular/core';
var SchedulerDateFormatter = /** @class */ (function (_super) {
    __extends(SchedulerDateFormatter, _super);
    function SchedulerDateFormatter(dateAdapter) {
        return _super.call(this, dateAdapter) || this;
    }
    /**
     * The time formatting down the left hand side of the day view
     */
    SchedulerDateFormatter.prototype.dayViewHour = function (_a) {
        var date = _a.date, locale = _a.locale;
        return new Intl.DateTimeFormat(locale, { hour: 'numeric', minute: 'numeric' }).format(date);
    };
    SchedulerDateFormatter.prototype.weekViewTitle = function (_a) {
        var dateAdapter = _a.dateAdapter, date = _a.date, locale = _a.locale, weekStartsOn = _a.weekStartsOn, excludeDays = _a.excludeDays, daysInWeek = _a.daysInWeek, startsWithToday = _a.startsWithToday;
        // http://generatedcontent.org/post/59403168016/esintlapi
        var year = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(date);
        var month = new Intl.DateTimeFormat(locale, { month: 'short' }).format(date);
        var dateInner = startsWithToday || daysInWeek < DAYS_IN_WEEK
            ? date
            : dateAdapter.startOfWeek(date, { weekStartsOn: weekStartsOn });
        // var firstDay: number = date.getDate() - date.getDay() + 1; // First day is the day of the month - the day of the week
        var firstDay = dateInner.getDate();
        while (excludeDays.includes(firstDay)) {
            firstDay += 1;
        }
        var lastDay = firstDay + (daysInWeek - 1); // last day is the first day + (daysInWeek - 1)
        while (excludeDays.includes(lastDay)) {
            lastDay += 1;
        }
        var firstDayMonth = month;
        var lastDayMonth = month;
        var firstDayYear = year;
        var lastDayYear = year;
        if (firstDay < 1) {
            var prevMonthDate = new Date(dateInner.getFullYear(), dateInner.getMonth() - 1);
            firstDayMonth = new Intl.DateTimeFormat(locale, { month: 'short' }).format(prevMonthDate);
            var daysInPrevMonth = this.daysInMonth(prevMonthDate);
            var i = 0;
            var prevMonthDay = daysInPrevMonth;
            for (i = 0; i < Math.abs(firstDay); i++) {
                prevMonthDay--;
            }
            firstDay = prevMonthDay;
            var prevMonthYear = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(prevMonthDate);
            if (Number(prevMonthYear) < Number(year)) {
                firstDayYear = prevMonthYear;
            }
        }
        var daysInMonth = this.daysInMonth(dateInner);
        if (lastDay > daysInMonth) {
            var nextMonthDate = new Date(dateInner.getFullYear(), dateInner.getMonth() + 1);
            lastDayMonth = new Intl.DateTimeFormat(locale, { month: 'short' }).format(nextMonthDate);
            var i = 0;
            var nextMonthDay = 0;
            for (i = 0; i < (lastDay - daysInMonth); i++) {
                nextMonthDay++;
            }
            lastDay = nextMonthDay;
            var nextMonthYear = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(nextMonthDate);
            if (Number(nextMonthYear) > Number(year)) {
                lastDayYear = nextMonthYear;
            }
        }
        return "" + firstDay + (firstDayMonth !== lastDayMonth || lastDay === firstDay ? ' ' + firstDayMonth : '') +
            (firstDayYear !== lastDayYear ? ' ' + firstDayYear : '') +
            (lastDay === firstDay ? '' : " - " + lastDay + " " + lastDayMonth + " " + lastDayYear);
    };
    SchedulerDateFormatter.prototype.daysInMonth = function (anyDateInMonth) {
        return new Date(anyDateInMonth.getFullYear(), anyDateInMonth.getMonth() + 1, 0).getDate();
    };
    SchedulerDateFormatter.ctorParameters = function () { return [
        { type: DateAdapter }
    ]; };
    SchedulerDateFormatter.decorators = [
        { type: Injectable }
    ];
    SchedulerDateFormatter.ctorParameters = function () { return [
        { type: DateAdapter }
    ]; };
    return SchedulerDateFormatter;
}(CalendarDateFormatter));
export { SchedulerDateFormatter };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NoZWR1bGVyLWRhdGUtZm9ybWF0dGVyLnByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1jYWxlbmRhci1zY2hlZHVsZXIvIiwic291cmNlcyI6WyJtb2R1bGVzL3NjaGVkdWxlci9mb3JtYXR0ZXJzL3NjaGVkdWxlci1kYXRlLWZvcm1hdHRlci5wcm92aWRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLHFCQUFxQixFQUFFLG1CQUFtQixFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQzNGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxtQ0FBbUMsQ0FBQztBQUNqRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBTzNDO0lBQzRDLDBDQUFxQjtJQUM3RCxnQ0FBWSxXQUF3QjtlQUNoQyxrQkFBTSxXQUFXLENBQUM7SUFDdEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksNENBQVcsR0FBbEIsVUFBbUIsRUFBOEM7WUFBNUMsSUFBSSxVQUFBLEVBQUUsTUFBTSxZQUFBO1FBQzdCLE9BQU8sSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hHLENBQUM7SUFFTSw4Q0FBYSxHQUFwQixVQUFxQixFQUFtSDtZQUFqSCxXQUFXLGlCQUFBLEVBQUUsSUFBSSxVQUFBLEVBQUUsTUFBTSxZQUFBLEVBQUUsWUFBWSxrQkFBQSxFQUFFLFdBQVcsaUJBQUEsRUFBRSxVQUFVLGdCQUFBLEVBQUUsZUFBZSxxQkFBQTtRQUNwRyx5REFBeUQ7UUFDekQsSUFBTSxJQUFJLEdBQVcsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENB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OlsiaW1wb3J0IHsgQ2FsZW5kYXJEYXRlRm9ybWF0dGVyLCBEYXRlRm9ybWF0dGVyUGFyYW1zLCBEYXRlQWRhcHRlciB9IGZyb20gJ2FuZ3VsYXItY2FsZW5kYXInO1xyXG5pbXBvcnQgeyBEQVlTX0lOX1dFRUsgfSBmcm9tICcuLi91dGlscy9jYWxlbmRhci1zY2hlZHVsZXItdXRpbHMnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFNjaGVkdWxlckRhdGVGb3JtYXR0ZXJQYXJhbXMgZXh0ZW5kcyBEYXRlRm9ybWF0dGVyUGFyYW1zIHtcclxuICAgIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcjtcclxuICAgIHN0YXJ0c1dpdGhUb2RheTogYm9vbGVhbjtcclxufVxyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgU2NoZWR1bGVyRGF0ZUZvcm1hdHRlciBleHRlbmRzIENhbGVuZGFyRGF0ZUZvcm1hdHRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihkYXRlQWRhcHRlcjogRGF0ZUFkYXB0ZXIpIHtcclxuICAgICAgICBzdXBlcihkYXRlQWRhcHRlcik7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBUaGUgdGltZSBmb3JtYXR0aW5nIGRvd24gdGhlIGxlZnQgaGFuZCBzaWRlIG9mIHRoZSBkYXkgdmlld1xyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZGF5Vmlld0hvdXIoeyBkYXRlLCBsb2NhbGUgfTogU2NoZWR1bGVyRGF0ZUZvcm1hdHRlclBhcmFtcyk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgeyBob3VyOiAnbnVtZXJpYycsIG1pbnV0ZTogJ251bWVyaWMnIH0pLmZvcm1hdChkYXRlKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgd2Vla1ZpZXdUaXRsZSh7IGRhdGVBZGFwdGVyLCBkYXRlLCBsb2NhbGUsIHdlZWtTdGFydHNPbiwgZXhjbHVkZURheXMsIGRheXNJbldlZWssIHN0YXJ0c1dpdGhUb2RheSB9OiBTY2hlZHVsZXJEYXRlRm9ybWF0dGVyUGFyYW1zKTogc3RyaW5nIHtcclxuICAgICAgICAvLyBodHRwOi8vZ2VuZXJhdGVkY29udGVudC5vcmcvcG9zdC81OTQwMzE2ODAxNi9lc2ludGxhcGlcclxuICAgICAgICBjb25zdCB5ZWFyOiBzdHJpbmcgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChsb2NhbGUsIHsgeWVhcjogJ251bWVyaWMnIH0pLmZvcm1hdChkYXRlKTtcclxuICAgICAgICBjb25zdCBtb250aDogc3RyaW5nID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IG1vbnRoOiAnc2hvcnQnIH0pLmZvcm1hdChkYXRlKTtcclxuXHJcbiAgICAgICAgY29uc3QgZGF0ZUlubmVyOiBEYXRlID0gc3RhcnRzV2l0aFRvZGF5IHx8IGRheXNJbldlZWsgPCBEQVlTX0lOX1dFRUtcclxuICAgICAgICAgICAgPyBkYXRlXHJcbiAgICAgICAgICAgIDogZGF0ZUFkYXB0ZXIuc3RhcnRPZldlZWsoZGF0ZSwgeyB3ZWVrU3RhcnRzT246IHdlZWtTdGFydHNPbiB9KTtcclxuXHJcbiAgICAgICAgLy8gdmFyIGZpcnN0RGF5OiBudW1iZXIgPSBkYXRlLmdldERhdGUoKSAtIGRhdGUuZ2V0RGF5KCkgKyAxOyAvLyBGaXJzdCBkYXkgaXMgdGhlIGRheSBvZiB0aGUgbW9udGggLSB0aGUgZGF5IG9mIHRoZSB3ZWVrXHJcbiAgICAgICAgbGV0IGZpcnN0RGF5OiBudW1iZXIgPSBkYXRlSW5uZXIuZ2V0RGF0ZSgpO1xyXG4gICAgICAgIHdoaWxlIChleGNsdWRlRGF5cy5pbmNsdWRlcyhmaXJzdERheSkpIHtcclxuICAgICAgICAgICAgZmlyc3REYXkgKz0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBsYXN0RGF5OiBudW1iZXIgPSBmaXJzdERheSArIChkYXlzSW5XZWVrIC0gMSk7IC8vIGxhc3QgZGF5IGlzIHRoZSBmaXJzdCBkYXkgKyAoZGF5c0luV2VlayAtIDEpXHJcbiAgICAgICAgd2hpbGUgKGV4Y2x1ZGVEYXlzLmluY2x1ZGVzKGxhc3REYXkpKSB7XHJcbiAgICAgICAgICAgIGxhc3REYXkgKz0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBmaXJzdERheU1vbnRoOiBzdHJpbmcgPSBtb250aDtcclxuICAgICAgICBsZXQgbGFzdERheU1vbnRoOiBzdHJpbmcgPSBtb250aDtcclxuXHJcbiAgICAgICAgbGV0IGZpcnN0RGF5WWVhcjogc3RyaW5nID0geWVhcjtcclxuICAgICAgICBsZXQgbGFzdERheVllYXI6IHN0cmluZyA9IHllYXI7XHJcblxyXG4gICAgICAgIGlmIChmaXJzdERheSA8IDEpIHtcclxuICAgICAgICAgICAgY29uc3QgcHJldk1vbnRoRGF0ZTogRGF0ZSA9IG5ldyBEYXRlKGRhdGVJbm5lci5nZXRGdWxsWWVhcigpLCBkYXRlSW5uZXIuZ2V0TW9udGgoKSAtIDEpO1xyXG4gICAgICAgICAgICBmaXJzdERheU1vbnRoID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IG1vbnRoOiAnc2hvcnQnIH0pLmZvcm1hdChwcmV2TW9udGhEYXRlKTtcclxuICAgICAgICAgICAgY29uc3QgZGF5c0luUHJldk1vbnRoOiBudW1iZXIgPSB0aGlzLmRheXNJbk1vbnRoKHByZXZNb250aERhdGUpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGk6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGxldCBwcmV2TW9udGhEYXk6IG51bWJlciA9IGRheXNJblByZXZNb250aDtcclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IE1hdGguYWJzKGZpcnN0RGF5KTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBwcmV2TW9udGhEYXktLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmaXJzdERheSA9IHByZXZNb250aERheTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHByZXZNb250aFllYXI6IHN0cmluZyA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgeyB5ZWFyOiAnbnVtZXJpYycgfSkuZm9ybWF0KHByZXZNb250aERhdGUpO1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyKHByZXZNb250aFllYXIpIDwgTnVtYmVyKHllYXIpKSB7XHJcbiAgICAgICAgICAgICAgICBmaXJzdERheVllYXIgPSBwcmV2TW9udGhZZWFyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBkYXlzSW5Nb250aDogbnVtYmVyID0gdGhpcy5kYXlzSW5Nb250aChkYXRlSW5uZXIpO1xyXG4gICAgICAgIGlmIChsYXN0RGF5ID4gZGF5c0luTW9udGgpIHtcclxuICAgICAgICAgICAgY29uc3QgbmV4dE1vbnRoRGF0ZTogRGF0ZSA9IG5ldyBEYXRlKGRhdGVJbm5lci5nZXRGdWxsWWVhcigpLCBkYXRlSW5uZXIuZ2V0TW9udGgoKSArIDEpO1xyXG4gICAgICAgICAgICBsYXN0RGF5TW9udGggPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChsb2NhbGUsIHsgbW9udGg6ICdzaG9ydCcgfSkuZm9ybWF0KG5leHRNb250aERhdGUpO1xyXG5cclxuICAgICAgICAgICAgbGV0IGk6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGxldCBuZXh0TW9udGhEYXk6IG51bWJlciA9IDA7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAobGFzdERheSAtIGRheXNJbk1vbnRoKTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0TW9udGhEYXkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsYXN0RGF5ID0gbmV4dE1vbnRoRGF5O1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbmV4dE1vbnRoWWVhcjogc3RyaW5nID0gbmV3IEludGwuRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCB7IHllYXI6ICdudW1lcmljJyB9KS5mb3JtYXQobmV4dE1vbnRoRGF0ZSk7XHJcbiAgICAgICAgICAgIGlmIChOdW1iZXIobmV4dE1vbnRoWWVhcikgPiBOdW1iZXIoeWVhcikpIHtcclxuICAgICAgICAgICAgICAgIGxhc3REYXlZZWFyID0gbmV4dE1vbnRoWWVhcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGAke2ZpcnN0RGF5fWAgKyAoZmlyc3REYXlNb250aCAhPT0gbGFzdERheU1vbnRoIHx8IGxhc3REYXkgPT09IGZpcnN0RGF5ID8gJyAnICsgZmlyc3REYXlNb250aCA6ICcnKSArXHJcbiAgICAgICAgICAgIChmaXJzdERheVllYXIgIT09IGxhc3REYXlZZWFyID8gJyAnICsgZmlyc3REYXlZZWFyIDogJycpICtcclxuICAgICAgICAgICAgKGxhc3REYXkgPT09IGZpcnN0RGF5ID8gJycgOiBgIC0gJHtsYXN0RGF5fSAke2xhc3REYXlNb250aH0gJHtsYXN0RGF5WWVhcn1gKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGRheXNJbk1vbnRoKGFueURhdGVJbk1vbnRoOiBEYXRlKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gbmV3IERhdGUoYW55RGF0ZUluTW9udGguZ2V0RnVsbFllYXIoKSwgYW55RGF0ZUluTW9udGguZ2V0TW9udGgoKSArIDEsIDApLmdldERhdGUoKTtcclxuICAgIH1cclxufVxyXG4iXX0=